{namespace neos=Neos\Neos\ViewHelpers}
<style>
<![CDATA[
    .color-brown {
        color: #6e584f !important;
    }
    .color-orange {
        color: #ff7800;
    }
    .Button--warn {
        background-color: #ff7800;
    }
    .display-flex {
        display: flex;
    }
    .donateForm .input {
        font-size: 1.125rem;
    }
    .PaymentSelector {
        display: flex;
    }
    .PaymentSelector-item {
        padding: 12px 24px;
        box-shadow: 0px 0px 0px 1px #ccc inset;
    }
    @media (max-width: 380px) {
        .PaymentSelector-item {
            font-size: 14px;
        }
    }
    .PaymentSelector-item.isActive {
        box-shadow: none;
        background-color: #ff7800;
        color: white !important;
        font-weight: bold;
    }
    .amountPicker {
        position: relative;
    }
    .amountPicker-cell {
        width: 20%;
        float: left;
        padding: 12px 24px;
        color: #828282;
        box-shadow:
            1px 0 0 0 #ccc,
            0 1px 0 0 #ccc,
            1px 1px 0 0 #ccc,
            1px 0 0 0 #ccc inset,
            0 1px 0 0 #ccc inset;
    }
    .amountPicker-cell--input {
        width: 40%;
    }
    @media (max-width: 880px) {
        .amountPicker-cell {
            width: 33%;
        }
    }
    @media (max-width: 580px) {
        .amountPicker-cell {
            width: 50%;
        }
        .amountPicker-cell--input {
            width: 100%;
        }
    }
    .amountPicker-cell.isActive {
        font-weight: bold;
        background-color: #ff7800;
        color: white !important;
    }
    .js-switcher-item {
        cursor: pointer;
    }
    .amountPicker .isActive .input {
        color: white;
    }
    .amountPicker .isActive .input::placeholder {
        color: white;
    }
    .paymentForm {
        padding: 48px;
    }
    @media (max-width: 490px) {
        .paymentForm {
            padding: 12px;
        }
    }
]]>
</style>
<a name="donate"></a>
<div class="paddingVertical-triple marginVertical-triple">
    <div class="row">
        <div style="border: 10px solid #ff7800" class="paymentForm columns medium-10 medium-offset-1">
            <h2 style="margin-top: 12px; margin-bottom: 48px" class="H2 textAlign-center">{moto -> f:format.raw()}</h2>

            <form data-referer="{projectId}" class="donateForm" role="form">
                {projectSelectBox -> f:format.raw()}
                <div style="margin: 0" class="row PaymentSelector js-switcher">
                    <div data-value="once" class="textAlign-center column small-6 ParagraphAlt--Large color-grayAlt js-switcher-item PaymentSelector-item isActive">Разовое пожертвование</div>
                    <div data-value="monthly" class="textAlign-center column small-6 ParagraphAlt--Large color-grayAlt js-switcher-item PaymentSelector-item">Ежемесячное пожертвование</div>
                </div>

                <div class="ParagraphAlt--Small color-grayAlt marginBottom-half marginTop-double">Сумма</div>

                <div class="amountPicker js-switcher">
                    <div data-value="100" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">100&nbsp;руб.</div>
                    <div data-value="200" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">200&nbsp;руб.</div>
                    <div data-value="500" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">500&nbsp;руб.</div>
                    <div data-value="1000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell isActive">1&nbsp;000&nbsp;руб.</div>
                    <div data-value="1500" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">1&nbsp;500&nbsp;руб.</div>
                    <div data-value="2000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">2&nbsp;000&nbsp;руб.</div>
                    <div data-value="5000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">5&nbsp;000&nbsp;руб.</div>
                    <div data-value="10000" class="textAlign-center ParagraphAlt--Large color-grayAlt js-switcher-item amountPicker-cell">10&nbsp;000&nbsp;руб.</div>
                    <div class="js-switcher-item textAlign-center ParagraphAlt--Large color-grayAlt amountPicker-cell amountPicker-cell--input" style="padding: 0" colspan="2">
                        <input class="input" min="0" style="background-color: transparent; padding: 12px 24px; margin-bottom: 0 !important; width: 100%; border: 0; text-align: center; font-size: 1.125rem;"
                            name="amount-other" placeholder="Другая сумма" type="number">
                    </div>
                </div>

                <div class="row">
                    <div class="columns small-6">
                        <div class="ParagraphAlt--Small color-grayAlt marginBottom-half paddingTop-double">
                            <label>Имя</label>
                        </div>
                        <input class="input" name="firstName" placeholder="Имя" type="text" value="">
                    </div>
                    <div class="columns small-6">
                        <div class="ParagraphAlt--Small color-grayAlt marginBottom-half paddingTop-double">
                            <label>Фамилия</label>
                        </div>
                        <input class="input" name="lastName" placeholder="Фамилия" type="text" value="">
                    </div>
                </div>

                <div class="ParagraphAlt--Small color-grayAlt marginBottom-half">
                    <label>Ваш e-mail</label>
                </div>
                <input class="input" name="email" placeholder="your@email.ru" type="text" value="">

                <div>
                    <div>
                        <div class="row ParagraphAlt--Small color-grayAlt">
                            <div class="small-6 columns">
                                <input checked class="" name="agreeOffer" type="checkbox" disabled checked="checked"> Я ознакомился c
                                <a style="text-decoration: underline" href="https://psmb-neos-resources.hb.bizmrg.com/target/sfi/fec577867ad88cd297f059ffe90fc43c2b5a4d69/%D0%BE%D1%84%D0%B5%D1%80%D1%82%D0%B0.pdf">договором-офертой</a> и согласен с ней
                            </div>
                            <div class="small-6 columns">
                                <input checked class="" name="agreePolicy" type="checkbox" disabled checked="checked"> Я ознакомился c
                                <a style="text-decoration: underline" href="https://psmb-neos-resources.hb.bizmrg.com/target/sfi/fec577867ad88cd297f059ffe90fc43c2b5a4d69/%D0%BE%D1%84%D0%B5%D1%80%D1%82%D0%B0.pdf">политикой обработки персональных данных </a> и согласен с ней
                            </div>
                        </div>
                        <div class="row ParagraphAlt--Small color-grayAlt">
                            <div class="small-6 columns">
                                <input checked class="" name="agreeRf" type="checkbox" disabled checked="checked"> Я являюсь гражданином Российской Федерации
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 48px" class="textAlign-center">
                    <button style="width: 100%; font-weight: bold;" class="Button Button--warn" type="submit">Пожертвовать</button>
                </div>

            </form>
        </div>
    </div>
</div>


<script src="https://widget.cloudpayments.ru/bundles/cloudpayments"></script>
<script type="text/javascript"><![CDATA[

(function() {
    Array.prototype.forEach.call(document.querySelectorAll('.js-switcher'), function (root) {
        root.addEventListener('click', function (event) {
            if (event.target.classList.contains('js-switcher-item') || event.target.parentElement.classList.contains('js-switcher-item')) {
                Array.prototype.forEach.call(root.querySelectorAll('.js-switcher-item'), function (element) {
                    element.classList.remove('isActive');
                    if (event.target !== element && event.target !== element.querySelector('.input') && element.querySelector('.input') && element.querySelector('.input').value) {
                        element.querySelector('.input').value = '';
                    }
                });
                if (event.target.classList.contains('js-switcher-item')) {
                    event.target.classList.add('isActive');
                }
                if (event.target.parentElement.classList.contains('js-switcher-item')) {
                    event.target.parentElement.classList.add('isActive');
                }
            }
        });
    });


    var form = document.querySelector('.donateForm');
    var pay = function (event) {
        event.preventDefault();

        function getAmount() {
            var activeElement = form.querySelector('.amountPicker .isActive');
            if (activeElement.dataset.value) {
                return Number(activeElement.dataset.value);
            } else {
                var input = activeElement.querySelector('.input');
                if (input && input.value) {
                    return Number(input.value);
                } else if (input && !input.value) {
                    alert('Вы не указали сумму пожертвования!');
                }
            }
        }

        if (form.querySelector('[name=agreeOffer]').value && form.querySelector('[name=agreeRf]').value && form.querySelector('[name=agreePolicy]').value) {
            var referer = form.querySelector('[name=projectSelector]') && form.querySelector('[name=projectSelector]').value || form.dataset.referer
            var widget = new cp.CloudPayments();

            var urlParams = new URLSearchParams(window.location.search);
            var data = {
                firstName: form.querySelector('[name=firstName]').value,
                lastName: form.querySelector('[name=lastName]').value,
                referer: referer,
                comment: urlParams.get('ref') || ''
            };

            var settings = {
                chapel: {
                    publicId: 'pk_415cecbcf382aff40554dd2b12ed2',
                    description: 'Образовательная деятельность СФИ'
                },
                projects: {
                    publicId: 'pk_76f3a38f1ebea58ef0e9b816c957c',
                    description: 'Научная деятельность СФИ'
                },
                social: {
                    publicId: 'pk_f8cf013ff4e254ccdff7bca75e38e',
                    description: 'Новая профессия: «Социальный координатор»'
                },
                publishing: {
                    publicId: 'pk_2937759f3704624324bb94d73d42b',
                    description: 'Издательская деятельность'
                }
            };

            var isRecurrent = form.querySelector('.PaymentSelector .isActive').dataset.value === 'monthly';
            if (isRecurrent) {
                data.cloudPayments = {
                    recurrent: {
                        interval: 'Month',
                        period: 1
                    }
                };
            }
            widget.charge(
                {
                    publicId: settings[referer].publicId,
                    description: settings[referer].description + (isRecurrent ? ' (регулярное)' : ''),
                    amount: getAmount(),
                    currency: 'RUB',
                    accountId: form.querySelector('[name=email]').value,
                    email: form.querySelector('[name=email]').value,
                    data: data
                },
                'http://sfi.ru/support/thanks.html',
                function (reason, options) {
                    alert('Ошибка' + reason);
                }
            );
        } else {
            alert('Ошибка');
        }
    };
    form.addEventListener('submit', pay);
})();

]]></script>
